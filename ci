#!/usr/bin/env zsh

set -e
set -x

export RUSTFLAGS="--deny warnings"

pushd meta
cargo build
popd

cargo fmt -- --check
cargo hack check

for package in `target/debug/publish`
do
    pushd $package
    cargo hack --feature-powerset build --all-targets
    cargo hack --feature-powerset test
    cargo doc --no-deps
    cargo clippy --no-deps --all-targets
    ../target/debug/binaries
    popd
done

set +x
echo SUCCESS: this concludes our successful CI adventure
