#!/bin/bash

set -x
set -u
set -o errexit
set -o pipefail

cargo fmt -- --check

ROOTDIR="`pwd`"
export PATH="$PATH":"`pwd`"/target/release

cargo build --release --bins
target/release/publish > .ci.packages

for package in `cat .ci.packages`
do
    pushd $package
    cargo clippy --no-deps --all-targets -- -D warnings -D clippy::all
    cargo hack --feature-powerset test --release
    cargo doc --no-deps
    "${ROOTDIR}/target/release/binaries"
    popd
done

set +x
echo SUCCESS: this concludes our successful CI adventure
